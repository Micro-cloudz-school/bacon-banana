<!DOCTYPE html>
<head></head>
<body>
<html>

<h1 id="speechshower"></h1>
<button type="button" onclick="connectSerial()">Connect Serial Baud 9600</button>


<script>

 let port;
let writer;

async function connectSerial() {
    try {
        // Ask the user to select a port and open a connection
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 9600 });

        const encoder = new TextEncoderStream();
        encoder.readable.pipeTo(port.writable);
        writer = encoder.writable.getWriter();

        console.log("YAY! Serial connection established!");
    } catch (err) {
        console.error(":( Serial connection failed:", err);
    }
}

async function sendSerialMessage(message) {
    if (writer) {
        await writer.write(message + "\n");
        console.log("Sent to Arduino:", message);
    } else {
        console.warn("Connect first");
    }
}

  
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
  const recognition = new SpeechRecognition();
  recognition.lang = 'en-CA';
  recognition.interimResults = false;
  recognition.continuous = true;

  recognition.onresult = (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript;
    console.log('You said:', transcript);
    document.getElementById("speechshower").innerHTML = transcript;
    sendSerialMessage(transcript);
  };

  recognition.onerror = (event) => {
    console.error('Speech recognition error:', event.error);
  };

  recognition.onend = () => {
    console.log('Speech recognition ended, restarting...');
    recognition.start(); // <-- restart automatically when it stops
  };

  recognition.start();
} else {
  console.warn('Web Speech API is not supported in this browser.');
}

</script>

</html>
</body>
